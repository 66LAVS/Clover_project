<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clover Drone Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a1931 0%, #1a1a2e 100%);
            color: #f1f1f1;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 2px solid rgba(32, 201, 151, 0.2);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: #20c997;
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(to right, #20c997, #00b4d8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(32, 201, 151, 0.3);
        }
        
        .subtitle {
            color: #a0a0c0;
            font-size: 1.2rem;
            margin-top: 5px;
        }
        
        .connection-panel {
            background: rgba(10, 25, 49, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(32, 201, 151, 0.2);
        }
        
        .connection-form {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #20c997;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(32, 201, 151, 0.3);
            border-radius: 8px;
            color: #f1f1f1;
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #20c997;
            box-shadow: 0 0 0 2px rgba(32, 201, 151, 0.2);
        }
        
        .connect-btn {
            background: linear-gradient(135deg, #20c997, #0d8b6f);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 25px;
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(32, 201, 151, 0.4);
        }
        
        .connect-btn:active {
            transform: translateY(0);
        }
        
        .connect-btn.disconnected {
            background: linear-gradient(135deg, #6c757d, #495057);
        }
        
        .connect-btn.connecting {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }
        
        .connect-btn.connected {
            background: linear-gradient(135deg, #20c997, #0d8b6f);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(10, 25, 49, 0.8);
            border-radius: 15px;
            padding: 15px 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(32, 201, 151, 0.2);
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #dc3545;
            position: relative;
        }
        
        .status-indicator::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            border: 1px solid #dc3545;
            opacity: 0;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.connected {
            background: #20c997;
        }
        
        .status-indicator.connected::after {
            border-color: #20c997;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.connecting {
            background: #ffc107;
            animation: blink 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            70% { transform: scale(1.5); opacity: 0; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .status-text {
            font-weight: 600;
            color: #e9ecef;
        }
        
        .status-value {
            color: #a0a0c0;
            font-size: 0.9rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .panel {
            background: rgba(10, 25, 49, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(32, 201, 151, 0.2);
            margin-bottom: 30px;
        }
        
        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: #20c997;
            font-size: 1.4rem;
        }
        
        .panel-title i {
            font-size: 1.6rem;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #1a3a5f, #162447);
            border: 1px solid rgba(32, 201, 151, 0.2);
            border-radius: 10px;
            color: white;
            padding: 18px 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            border-color: rgba(32, 201, 151, 0.5);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        .control-btn:active {
            transform: translateY(1px);
        }
        
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .control-btn i {
            font-size: 1.6rem;
            color: #20c997;
        }
        
        .control-btn.emergency {
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            border-color: rgba(220, 53, 69, 0.3);
        }
        
        .control-btn.emergency i {
            color: #ff6b6b;
        }
        
        .telemetry-btn {
            background: linear-gradient(135deg, #2d3748, #4a5568);
            width: 100%;
            padding: 18px;
            font-size: 1.1rem;
            border: 1px solid rgba(32, 201, 151, 0.3);
        }
        
        .telemetry-btn i {
            color: #20c997;
        }
        
        .gps-section {
            margin-bottom: 25px;
        }
        
        .gps-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 12px;
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(32, 201, 151, 0.2);
            border-radius: 8px;
            color: #a0a0c0;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .toggle-btn:hover {
            border-color: rgba(32, 201, 151, 0.5);
        }
        
        .toggle-btn.active {
            background: rgba(32, 201, 151, 0.1);
            border-color: #20c997;
            color: #20c997;
        }
        
        .gps-data {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(32, 201, 151, 0.1);
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .data-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .data-label {
            font-weight: 600;
            color: #a0a0c0;
        }
        
        .data-value {
            font-weight: 700;
            color: #20c997;
            font-family: 'Courier New', monospace;
        }
        
        .map-container {
            height: 350px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
            position: relative;
            border: 1px solid rgba(32, 201, 151, 0.1);
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .compass-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #a0a0c0;
            background: rgba(10, 25, 49, 0.5);
        }
        
        .compass {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 20px;
        }
        
        .compass-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(26, 26, 46, 0.9);
            border: 2px solid rgba(32, 201, 151, 0.3);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .compass-rose {
            position: absolute;
            width: 90%;
            height: 90%;
            top: 5%;
            left: 5%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50" y="15" text-anchor="middle" fill="%2320c997" font-size="12">N</text><text x="85" y="53" text-anchor="middle" fill="%2320c997" font-size="10">E</text><text x="50" y="90" text-anchor="middle" fill="%2320c997" font-size="12">S</text><text x="15" y="53" text-anchor="middle" fill="%2320c997" font-size="10">W</text><line x1="50" y1="20" x2="50" y2="40" stroke="%2320c997" stroke-width="2"/><line x1="50" y1="60" x2="50" y2="80" stroke="%2320c997" stroke-width="2"/><line x1="20" y1="50" x2="40" y2="50" stroke="%2320c997" stroke-width="2"/><line x1="60" y1="50" x2="80" y2="50" stroke="%2320c997" stroke-width="2"/></svg>') no-repeat center;
            background-size: contain;
            transition: transform 0.5s ease;
        }
        
        .compass-needle {
            position: absolute;
            width: 40%;
            height: 4px;
            background: linear-gradient(90deg, #dc3545, #ff6b6b);
            top: 48%;
            left: 50%;
            transform-origin: left center;
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
        }
        
        .compass-needle::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: #dc3545;
            border-radius: 50%;
            right: -6px;
            top: -4px;
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.7);
        }
        
        .compass-reading {
            font-size: 1.2rem;
            color: #20c997;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .compass-info {
            text-align: center;
            margin-top: 20px;
            color: #a0a0c0;
        }
        
        .map-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            background: rgba(10, 25, 49, 0.5);
        }
        
        .map-placeholder i {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: rgba(32, 201, 151, 0.3);
        }
        
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(10, 25, 49, 0.9);
            border-radius: 5px;
            padding: 5px;
            border: 1px solid rgba(32, 201, 151, 0.2);
        }
        
        .map-btn {
            background: rgba(32, 201, 151, 0.2);
            border: none;
            color: #20c997;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
            transition: all 0.3s ease;
        }
        
        .map-btn:hover {
            background: rgba(32, 201, 151, 0.4);
        }
        
        .drone-marker {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2320c997"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>') no-repeat center;
            background-size: contain;
            width: 40px;
            height: 40px;
            filter: drop-shadow(0 0 5px rgba(32, 201, 151, 0.7));
        }
        
        .variables-panel {
            margin-top: 30px;
        }
        
        .variable-item {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(32, 201, 151, 0.1);
        }
        
        .variable-name {
            font-weight: 600;
            color: #a0a0c0;
        }
        
        .variable-value {
            background: rgba(10, 25, 49, 0.8);
            padding: 6px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            color: #20c997;
            border: 1px solid rgba(32, 201, 151, 0.2);
        }
        
        .hidden {
            display: none !important;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #20c997, #0d8b6f);
            border-left: 4px solid #0d8b6f;
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            border-left: 4px solid #e0a800;
            color: #212529;
        }
        
        .notification.error {
            background: linear-gradient(135deg, #dc3545, #c82333);
            border-left: 4px solid #c82333;
        }
        
        .notification.info {
            background: linear-gradient(135deg, #00b4d8, #0096c7);
            border-left: 4px solid #0096c7;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .controls-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .connection-form {
                flex-direction: column;
            }
            
            .form-group {
                width: 100%;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .compass {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-helicopter"></i>
                <h1>Clover Drone Control</h1>
            </div>
            <p class="subtitle">Веб-интерфейс для управления коптером Clover через Wi-Fi сеть дрона</p>
        </header>
        
        <div class="connection-panel">
            <div class="connection-form">
                <div class="form-group">
                    <label class="form-label">IP адрес дрона</label>
                    <input type="text" id="drone-ip" class="form-input" value="192.168.11.1" placeholder="Введите IP дрона">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Порт</label>
                    <input type="text" id="drone-port" class="form-input" value="8080" placeholder="Порт">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Статус подключения</label>
                    <div style="display: flex; align-items: center; height: 48px;">
                        <span id="connection-status-text" style="color: #dc3545; font-weight: 600;">Не подключено</span>
                    </div>
                </div>
            </div>
            
            <button class="connect-btn disconnected" id="connect-btn">
                <i class="fas fa-plug"></i>
                <span>Подключиться к дрону</span>
            </button>
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="connection-status-indicator"></div>
                <div>
                    <div class="status-text">Подключение к дрону</div>
                    <div class="status-value" id="connection-details">Ожидание подключения...</div>
                </div>
            </div>
            
            <div class="status-item">
                <div class="status-indicator" id="gps-status-indicator"></div>
                <div>
                    <div class="status-text">GPS модуль</div>
                    <div class="status-value" id="gps-details">Не обнаружен</div>
                </div>
            </div>
            
            <div class="status-item">
                <div class="status-indicator" id="telemetry-status-indicator"></div>
                <div>
                    <div class="status-text">Телеметрия</div>
                    <div class="status-value" id="telemetry-details">Неактивна</div>
                </div>
            </div>
            
            <div class="status-item">
                <div class="status-indicator" id="battery-status-indicator"></div>
                <div>
                    <div class="status-text">Батарея</div>
                    <div class="status-value" id="battery-details">Неизвестно</div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="left-column">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-gamepad"></i> Управление коптером</h2>
                    
                    <div class="controls-grid">
                        <button class="control-btn" id="takeoff-btn" disabled>
                            <i class="fas fa-plane-departure"></i>
                            <span>Взлет</span>
                        </button>
                        
                        <button class="control-btn" id="land-btn" disabled>
                            <i class="fas fa-plane-arrival"></i>
                            <span>Посадка</span>
                        </button>
                        
                        <button class="control-btn emergency" id="emergency-btn" disabled>
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Аварийная остановка</span>
                        </button>
                        
                        <button class="control-btn" id="hover-btn" disabled>
                            <i class="fas fa-pause-circle"></i>
                            <span>Зависнуть</span>
                        </button>
                        
                        <button class="control-btn" id="return-btn" disabled>
                            <i class="fas fa-home"></i>
                            <span>Возврат</span>
                        </button>
                        
                        <button class="control-btn" id="calibrate-btn" disabled>
                            <i class="fas fa-compass"></i>
                            <span>Калибровка</span>
                        </button>
                    </div>
                    
                    <button class="control-btn telemetry-btn" id="telemetry-btn" disabled>
                        <i class="fas fa-satellite-dish"></i>
                        <span>Активировать телеметрию</span>
                    </button>
                </div>
                
                <div class="panel gps-section hidden" id="gps-panel">
                    <h2 class="panel-title"><i class="fas fa-satellite"></i> Навигация</h2>
                    
                    <div class="gps-toggle">
                        <button class="toggle-btn active" id="gps-standard">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Стандартный GPS</span>
                        </button>
                        <button class="toggle-btn" id="gps-segmented">
                            <i class="fas fa-map-marked-alt"></i>
                            <span>Сегментированный GPS</span>
                        </button>
                    </div>
                    
                    <div class="gps-data">
                        <div class="data-row">
                            <div class="data-label">Координаты:</div>
                            <div class="data-value" id="coordinates">55.7522° N, 37.6156° E</div>
                        </div>
                        
                        <div class="data-row">
                            <div class="data-label">Скорость:</div>
                            <div class="data-value" id="speed">0.0 м/с</div>
                        </div>
                        
                        <div class="data-row">
                            <div class="data-label">Высота:</div>
                            <div class="data-value" id="altitude">0.0 м</div>
                        </div>
                        
                        <div class="data-row">
                            <div class="data-label">Курс:</div>
                            <div class="data-value" id="heading">0°</div>
                        </div>
                    </div>
                    
                    <div class="map-container">
                        <div id="map"></div>
                        <div class="compass-container hidden" id="compass-container">
                            <div class="compass">
                                <div class="compass-face"></div>
                                <div class="compass-rose" id="compass-rose"></div>
                                <div class="compass-needle" id="compass-needle"></div>
                            </div>
                            <div class="compass-reading" id="compass-reading">0°</div>
                            <div class="compass-info">
                                <p><i class="fas fa-info-circle"></i> GPS недоступен, используется компас</p>
                                <p>Направление дрона относительно севера</p>
                            </div>
                        </div>
                        <div class="map-placeholder hidden" id="map-placeholder">
                            <i class="fas fa-map"></i>
                            <h3>Навигационная панель</h3>
                            <p>Подключитесь к дрону для отображения навигационных данных</p>
                        </div>
                        <div class="map-controls" id="map-controls">
                            <button class="map-btn" id="zoom-in"><i class="fas fa-plus"></i></button>
                            <button class="map-btn" id="zoom-out"><i class="fas fa-minus"></i></button>
                            <button class="map-btn" id="locate-drone"><i class="fas fa-crosshairs"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-column">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-chart-line"></i> Телеметрия в реальном времени</h2>
                    
                    <div class="gps-data">
                        <div class="data-row">
                            <div class="data-label">Скорость движения:</div>
                            <div class="data-value" id="movement-speed">0.0 м/с</div>
                        </div>
                        
                        <div class="data-row">
                            <div class="data-label">Радиус наклона:</div>
                            <div class="data-value" id="tilt-radius">0°</div>
                        </div>
                        
                        <div class="data-row">
                            <div class="data-label">Диаметр (охват):</div>
                            <div class="data-value" id="diameter">0.0 м</div>
                        </div>
                        
                        <div class="data-row">
                            <div class="data-label">Высота:</div>
                            <div class="data-value" id="height-telemetry">0.0 м</div>
                        </div>
                    </div>
                </div>
                
                <div class="panel variables-panel">
                    <h2 class="panel-title"><i class="fas fa-microchip"></i> Системные переменные</h2>
                    
                    <div class="variable-item">
                        <div class="variable-name">Режим навигации:</div>
                        <div class="variable-value" id="nav-mode-value">Ожидание</div>
                    </div>
                    
                    <div class="variable-item">
                        <div class="variable-name">Статус навигации:</div>
                        <div class="variable-value" id="nav-status-value">Ожидание</div>
                    </div>
                    
                    <div class="variable-item">
                        <div class="variable-name">Точность GPS:</div>
                        <div class="variable-value" id="gps-accuracy-value">-</div>
                    </div>
                    
                    <div class="variable-item">
                        <div class="variable-name">Спутники:</div>
                        <div class="variable-value" id="satellites-value">0</div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-sliders-h"></i> Настройки дрона</h2>
                    
                    <div style="margin-top: 20px;">
                        <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="gps-enabled" disabled>
                            <label for="gps-enabled" style="color: #a0a0c0;">Включить GPS модуль</label>
                        </div>
                        
                        <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="telemetry-enabled" disabled>
                            <label for="telemetry-enabled" style="color: #a0a0c0;">Включить телеметрию</label>
                        </div>
                        
                        <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="compass-enabled" checked disabled>
                            <label for="compass-enabled" style="color: #a0a0c0;">Использовать компас при отсутствии GPS</label>
                        </div>
                        
                        <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="auto-connect" checked>
                            <label for="auto-connect" style="color: #a0a0c0;">Автоподключение при загрузке</label>
                        </div>
                        
                        <button class="toggle-btn" style="width: 100%; margin-top: 10px;" id="refresh-btn" disabled>
                            <i class="fas fa-sync-alt"></i>
                            <span>Обновить компоненты</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Состояние системы
        const state = {
            connected: false,
            connecting: false,
            droneIP: '192.168.11.1',
            dronePort: '8080',
            hasGPS: false,
            hasTelemetry: false,
            gpsMode: 'standard',
            batteryLevel: 0,
            connectionInterval: null,
            telemetryInterval: null,
            map: null,
            droneMarker: null,
            currentLocation: [55.7522, 37.6156], // Москва по умолчанию
            currentHeading: 0
        };
        
        // Инициализация интерфейса
        function initInterface() {
            // Загружаем сохраненные настройки
            loadSettings();
            
            // Настраиваем кнопку подключения
            document.getElementById('connect-btn').addEventListener('click', toggleConnection);
            
            // Настраиваем кнопки GPS
            document.getElementById('gps-standard').addEventListener('click', () => setGpsMode('standard'));
            document.getElementById('gps-segmented').addEventListener('click', () => setGpsMode('segmented'));
            
            // Настраиваем кнопки управления
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.disabled) return;
                    const action = this.id.replace('-btn', '');
                    executeCommand(action);
                });
            });
            
            // Кнопка обновления компонентов
            document.getElementById('refresh-btn').addEventListener('click', function() {
                checkDroneComponents();
                showNotification('Компоненты дрона обновлены', 'success');
            });
            
            // Кнопки управления картой
            document.getElementById('zoom-in').addEventListener('click', () => {
                if (state.map) state.map.zoomIn();
            });
            
            document.getElementById('zoom-out').addEventListener('click', () => {
                if (state.map) state.map.zoomOut();
            });
            
            document.getElementById('locate-drone').addEventListener('click', () => {
                if (state.map && state.droneMarker) {
                    state.map.setView(state.currentLocation, 17);
                }
            });
            
            // Переключатели
            document.getElementById('gps-enabled').addEventListener('change', function() {
                if (state.connected) {
                    // Здесь будет вызов API для включения/выключения GPS
                    showNotification(`GPS модуль ${this.checked ? 'включен' : 'выключен'}`, 'info');
                    if (!this.checked) {
                        switchToCompass();
                    } else {
                        checkDroneComponents();
                    }
                }
            });
            
            document.getElementById('telemetry-enabled').addEventListener('change', function() {
                if (state.connected) {
                    // Здесь будет вызов API для включения/выключения телеметрии
                    showNotification(`Телеметрия ${this.checked ? 'включена' : 'выключена'}`, 'info');
                }
            });
            
            // Обновление полей IP и порта
            document.getElementById('drone-ip').addEventListener('change', function() {
                state.droneIP = this.value;
                saveSettings();
            });
            
            document.getElementById('drone-port').addEventListener('change', function() {
                state.dronePort = this.value;
                saveSettings();
            });
            
            // Автоподключение при загрузке
            if (document.getElementById('auto-connect').checked) {
                setTimeout(() => {
                    connectToDrone();
                }, 1000);
            }
        }
        
        // Подключение/отключение от дрона
        function toggleConnection() {
            if (state.connecting) return;
            
            if (state.connected) {
                disconnectFromDrone();
            } else {
                connectToDrone();
            }
        }
        
        // Подключение к дрону
        async function connectToDrone() {
            state.connecting = true;
            updateConnectionUI('connecting');
            
            const ip = document.getElementById('drone-ip').value;
            const port = document.getElementById('drone-port').value;
            
            showNotification(`Попытка подключения к ${ip}:${port}...`, 'info');
            
            // Имитация подключения к дрону
            setTimeout(() => {
                const success = Math.random() > 0.2; // 80% успешных подключений в демо
                
                if (success) {
                    state.connected = true;
                    state.connecting = false;
                    updateConnectionUI('connected');
                    showNotification(`Успешно подключено к дрону ${ip}:${port}`, 'success');
                    
                    // Начинаем проверку компонентов дрона
                    checkDroneComponents();
                    
                    // Запускаем периодическую проверку подключения
                    startConnectionMonitor();
                    
                    // Запускаем обновление телеметрии
                    startTelemetryUpdates();
                } else {
                    state.connecting = false;
                    updateConnectionUI('disconnected');
                    showNotification(`Не удалось подключиться к дрону ${ip}:${port}`, 'error');
                }
            }, 1500);
        }
        
        // Отключение от дрона
        function disconnectFromDrone() {
            state.connected = false;
            state.connecting = false;
            
            // Останавливаем интервалы
            if (state.connectionInterval) {
                clearInterval(state.connectionInterval);
                state.connectionInterval = null;
            }
            
            if (state.telemetryInterval) {
                clearInterval(state.telemetryInterval);
                state.telemetryInterval = null;
            }
            
            // Удаляем карту если есть
            if (state.map) {
                state.map.remove();
                state.map = null;
                state.droneMarker = null;
            }
            
            updateConnectionUI('disconnected');
            showNotification('Отключено от дрона', 'info');
        }
        
        // Проверка компонентов дрона
        function checkDroneComponents() {
            if (!state.connected) return;
            
            // Имитация проверки компонентов дрона
            setTimeout(() => {
                state.hasGPS = Math.random() > 0.3;
                state.hasTelemetry = true;
                state.batteryLevel = Math.floor(Math.random() * 50) + 50; // 50-100%
                
                updateComponentsUI();
                
                if (state.hasGPS) {
                    showNotification('GPS модуль обнаружен', 'success');
                    initMap();
                } else {
                    showNotification('GPS модуль не обнаружен', 'warning');
                    switchToCompass();
                }
                
                showNotification(`Уровень батареи: ${state.batteryLevel}%`, 'info');
            }, 1000);
        }
        
        // Инициализация карты
        function initMap() {
            if (!state.hasGPS) return;
            
            // Скрываем компас и плейсхолдер
            document.getElementById('compass-container').classList.add('hidden');
            document.getElementById('map-placeholder').classList.add('hidden');
            
            // Показываем элементы управления картой
            document.getElementById('map-controls').classList.remove('hidden');
            
            // Инициализируем карту если еще не инициализирована
            if (!state.map) {
                state.map = L.map('map').setView(state.currentLocation, 15);
                
                // Добавляем слой OpenStreetMap
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(state.map);
                
                // Создаем кастомный маркер для дрона
                const droneIcon = L.divIcon({
                    className: 'drone-marker',
                    iconSize: [40, 40],
                    iconAnchor: [20, 20]
                });
                
                // Добавляем маркер дрона
                state.droneMarker = L.marker(state.currentLocation, {icon: droneIcon})
                    .addTo(state.map)
                    .bindPopup('<b>Положение дрона</b><br>GPS активен');
                
                // Добавляем круг точности GPS
                const accuracyCircle = L.circle(state.currentLocation, {
                    color: '#20c997',
                    fillColor: '#20c997',
                    fillOpacity: 0.1,
                    radius: 50
                }).addTo(state.map);
                
                showNotification('Карта GPS инициализирована', 'success');
            }
            
            // Обновляем переменную режима навигации
            document.getElementById('nav-mode-value').textContent = 'GPS навигация';
        }
        
        // Переключение на компас
        function switchToCompass() {
            if (state.map) {
                state.map.remove();
                state.map = null;
                state.droneMarker = null;
            }
            
            // Скрываем карту и элементы управления
            document.getElementById('map-controls').classList.add('hidden');
            document.getElementById('map-placeholder').classList.add('hidden');
            
            // Показываем компас
            document.getElementById('compass-container').classList.remove('hidden');
            
            // Обновляем переменную режима навигации
            document.getElementById('nav-mode-value').textContent = 'Компас';
            
            showNotification('Используется компас (GPS недоступен)', 'warning');
        }
        
        // Обновление UI подключения
        function updateConnectionUI(status) {
            const connectBtn = document.getElementById('connect-btn');
            const statusIndicator = document.getElementById('connection-status-indicator');
            const statusText = document.getElementById('connection-status-text');
            const statusDetails = document.getElementById('connection-details');
            
            // Обновляем кнопку
            connectBtn.className = 'connect-btn';
            connectBtn.classList.add(status);
            
            if (status === 'disconnected') {
                connectBtn.innerHTML = '<i class="fas fa-plug"></i><span>Подключиться к дрону</span>';
                statusIndicator.className = 'status-indicator';
                statusText.textContent = 'Не подключено';
                statusText.style.color = '#dc3545';
                statusDetails.textContent = 'Ожидание подключения...';
                
                // Отключаем кнопки управления
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.disabled = true;
                });
                document.getElementById('telemetry-btn').disabled = true;
                document.getElementById('refresh-btn').disabled = true;
                document.getElementById('gps-enabled').disabled = true;
                document.getElementById('telemetry-enabled').disabled = true;
                document.getElementById('compass-enabled').disabled = true;
                
                // Скрываем GPS панель
                document.getElementById('gps-panel').classList.add('hidden');
                
                // Показываем плейсхолдер
                document.getElementById('map-placeholder').classList.remove('hidden');
                document.getElementById('compass-container').classList.add('hidden');
                document.getElementById('map-controls').classList.add('hidden');
                
            } else if (status === 'connecting') {
                connectBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Подключение...</span>';
                statusIndicator.className = 'status-indicator connecting';
                statusText.textContent = 'Подключение...';
                statusText.style.color = '#ffc107';
                statusDetails.textContent = 'Установка соединения...';
                
            } else if (status === 'connected') {
                connectBtn.innerHTML = '<i class="fas fa-plug"></i><span>Отключиться от дрона</span>';
                statusIndicator.className = 'status-indicator connected';
                statusText.textContent = 'Подключено';
                statusText.style.color = '#20c997';
                statusDetails.textContent = `Дрон: ${state.droneIP}:${state.dronePort}`;
                
                // Включаем кнопки управления
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.disabled = false;
                });
                document.getElementById('telemetry-btn').disabled = false;
                document.getElementById('refresh-btn').disabled = false;
                document.getElementById('gps-enabled').disabled = false;
                document.getElementById('telemetry-enabled').disabled = false;
                document.getElementById('compass-enabled').disabled = false;
                
                // Показываем GPS панель
                document.getElementById('gps-panel').classList.remove('hidden');
            }
        }
        
        // Обновление UI компонентов
        function updateComponentsUI() {
            // GPS статус
            const gpsIndicator = document.getElementById('gps-status-indicator');
            const gpsDetails = document.getElementById('gps-details');
            const gpsPanel = document.getElementById('gps-panel');
            
            if (state.hasGPS) {
                gpsIndicator.className = 'status-indicator connected';
                gpsDetails.textContent = 'Обнаружен';
                gpsPanel.classList.remove('hidden');
            } else {
                gpsIndicator.className = 'status-indicator';
                gpsDetails.textContent = 'Не обнаружен';
                gpsPanel.classList.remove('hidden');
            }
            
            // Телеметрия статус
            const telemetryIndicator = document.getElementById('telemetry-status-indicator');
            const telemetryDetails = document.getElementById('telemetry-details');
            
            if (state.hasTelemetry) {
                telemetryIndicator.className = 'status-indicator connected';
                telemetryDetails.textContent = 'Активна';
            } else {
                telemetryIndicator.className = 'status-indicator';
                telemetryDetails.textContent = 'Неактивна';
            }
            
            // Батарея статус
            const batteryIndicator = document.getElementById('battery-status-indicator');
            const batteryDetails = document.getElementById('battery-details');
            
            if (state.batteryLevel > 50) {
                batteryIndicator.className = 'status-indicator connected';
            } else if (state.batteryLevel > 20) {
                batteryIndicator.className = 'status-indicator connecting';
            } else {
                batteryIndicator.className = 'status-indicator';
            }
            
            batteryDetails.textContent = `${state.batteryLevel}%`;
        }
        
        // Установка режима GPS
        function setGpsMode(mode) {
            state.gpsMode = mode;
            
            // Обновляем активную кнопку
            document.getElementById('gps-standard').classList.toggle('active', mode === 'standard');
            document.getElementById('gps-segmented').classList.toggle('active', mode === 'segmented');
            
            showNotification(`Режим GPS изменен на: ${mode === 'standard' ? 'Стандартный' : 'Сегментированный'}`, 'info');
        }
        
        // Выполнение команд управления
        function executeCommand(command) {
            if (!state.connected) {
                showNotification('Сначала подключитесь к дрону', 'error');
                return;
            }
            
            let message = '';
            
            switch(command) {
                case 'takeoff':
                    message = 'Команда взлета отправлена дрону';
                    document.getElementById('nav-status-value').textContent = 'Взлет';
                    break;
                case 'land':
                    message = 'Команда посадки отправлена дрону';
                    document.getElementById('nav-status-value').textContent = 'Посадка';
                    break;
                case 'emergency':
                    message = 'АВАРИЙНАЯ ОСТАНОВКА! Команда отправлена дрону';
                    document.getElementById('nav-status-value').textContent = 'Аварийная остановка';
                    break;
                case 'hover':
                    message = 'Команда зависания отправлена дрону';
                    document.getElementById('nav-status-value').textContent = 'Зависание';
                    break;
                case 'return':
                    message = 'Команда возврата отправлена дрону';
                    document.getElementById('nav-status-value').textContent = 'Возврат';
                    break;
                case 'calibrate':
                    message = 'Калибровка начата';
                    document.getElementById('nav-status-value').textContent = 'Калибровка';
                    // Калибровка компаса
                    calibrateCompass();
                    break;
                case 'telemetry':
                    message = 'Телеметрия активирована';
                    break;
                default:
                    message = 'Команда отправлена дрону';
            }
            
            showNotification(message, 'info');
        }
        
        // Калибровка компаса
        function calibrateCompass() {
            if (!state.connected) return;
            
            showNotification('Калибровка компаса... Держите дрон неподвижно', 'info');
            
            // Имитация калибровки
            setTimeout(() => {
                showNotification('Калибровка компаса завершена', 'success');
                document.getElementById('nav-status-value').textContent = 'Готов';
            }, 3000);
        }
        
        // Обновление компаса
        function updateCompass(heading) {
            const compassRose = document.getElementById('compass-rose');
            const compassNeedle = document.getElementById('compass-needle');
            const compassReading = document.getElementById('compass-reading');
            
            // Преобразуем градусы в радианы (для CSS transform)
            const rotation = heading;
            
            // Поворачиваем компас (отрицательное значение потому что карта поворачивается, а стрелка остается на севере)
            compassRose.style.transform = `rotate(${-rotation}deg)`;
            
            // Обновляем показания
            compassReading.textContent = `${Math.round(heading)}°`;
            
            // Определяем направление
            let direction = '';
            if (heading >= 337.5 || heading < 22.5) direction = 'С';
            else if (heading >= 22.5 && heading < 67.5) direction = 'СВ';
            else if (heading >= 67.5 && heading < 112.5) direction = 'В';
            else if (heading >= 112.5 && heading < 157.5) direction = 'ЮВ';
            else if (heading >= 157.5 && heading < 202.5) direction = 'Ю';
            else if (heading >= 202.5 && heading < 247.5) direction = 'ЮЗ';
            else if (heading >= 247.5 && heading < 292.5) direction = 'З';
            else if (heading >= 292.5 && heading < 337.5) direction = 'СЗ';
            
            compassReading.textContent = `${Math.round(heading)}° (${direction})`;
        }
        
        // Запуск мониторинга подключения
        function startConnectionMonitor() {
            if (state.connectionInterval) {
                clearInterval(state.connectionInterval);
            }
            
            state.connectionInterval = setInterval(() => {
                if (!state.connected) return;
                
                // Имитация случайного отключения (10% шанс в демо)
                if (Math.random() < 0.1) {
                    showNotification('Потеряно соединение с дроном', 'error');
                    disconnectFromDrone();
                }
            }, 5000);
        }
        
        // Запуск обновлений телеметрии
        function startTelemetryUpdates() {
            if (state.telemetryInterval) {
                clearInterval(state.telemetryInterval);
            }
            
            // Первое обновление сразу
            updateTelemetryData();
            
            // Затем каждые 2 секунды
            state.telemetryInterval = setInterval(updateTelemetryData, 2000);
        }
        
        // Обновление данных телеметрии
        function updateTelemetryData() {
            if (!state.connected || !state.hasTelemetry) return;
            
            // Генерация случайных данных для имитации
            const speed = (Math.random() * 5).toFixed(1);
            const altitude = state.hasGPS ? (1 + Math.random() * 50).toFixed(1) : "0.0";
            const tilt = (Math.random() * 15).toFixed(1);
            state.currentHeading = (state.currentHeading + Math.random() * 10 - 5) % 360;
            const diameter = (0.3 + Math.random() * 2).toFixed(1);
            
            // Обновление значений на экране
            document.getElementById('speed').textContent = `${speed} м/с`;
            document.getElementById('movement-speed').textContent = `${speed} м/с`;
            document.getElementById('altitude').textContent = `${altitude} м`;
            document.getElementById('height-telemetry').textContent = `${altitude} м`;
            document.getElementById('tilt-radius').textContent = `${tilt}°`;
            document.getElementById('heading').textContent = `${Math.round(state.currentHeading)}°`;
            document.getElementById('diameter').textContent = `${diameter} м`;
            
            // Обновление компаса если GPS нет
            if (!state.hasGPS) {
                updateCompass(state.currentHeading);
            }
            
            // Обновление координат и карты (если есть GPS)
            if (state.hasGPS && state.map) {
                // Слегка меняем координаты для имитации движения
                const latChange = (Math.random() - 0.5) * 0.0005;
                const lonChange = (Math.random() - 0.5) * 0.0005;
                
                state.currentLocation[0] += latChange;
                state.currentLocation[1] += lonChange;
                
                // Обновляем координаты на экране
                document.getElementById('coordinates').textContent = 
                    `${state.currentLocation[0].toFixed(6)}° N, ${state.currentLocation[1].toFixed(6)}° E`;
                
                // Обновляем маркер на карте
                if (state.droneMarker) {
                    state.droneMarker.setLatLng(state.currentLocation);
                }
                
                // Обновляем точность GPS
                const accuracy = (0.5 + Math.random() * 3).toFixed(1);
                document.getElementById('gps-accuracy-value').textContent = `${accuracy} м`;
                
                // Обновление количества спутников
                const satellites = 5 + Math.floor(Math.random() * 8);
                document.getElementById('satellites-value').textContent = satellites;
            }
            
            // Обновление уровня батареи
            if (state.batteryLevel > 0) {
                state.batteryLevel = Math.max(0, state.batteryLevel - 0.1);
                document.getElementById('battery-details').textContent = `${state.batteryLevel.toFixed(1)}%`;
                
                // Обновляем индикатор батареи
                const batteryIndicator = document.getElementById('battery-status-indicator');
                if (state.batteryLevel > 50) {
                    batteryIndicator.className = 'status-indicator connected';
                } else if (state.batteryLevel > 20) {
                    batteryIndicator.className = 'status-indicator connecting';
                } else {
                    batteryIndicator.className = 'status-indicator';
                    if (state.batteryLevel < 10) {
                        showNotification('Низкий заряд батареи!', 'warning');
                    }
                }
            }
        }
        
        // Сохранение настроек в localStorage
        function saveSettings() {
            const settings = {
                droneIP: document.getElementById('drone-ip').value,
                dronePort: document.getElementById('drone-port').value,
                autoConnect: document.getElementById('auto-connect').checked
            };
            localStorage.setItem('cloverDroneSettings', JSON.stringify(settings));
        }
        
        // Загрузка настроек из localStorage
        function loadSettings() {
            const saved = localStorage.getItem('cloverDroneSettings');
            if (saved) {
                try {
                    const settings = JSON.parse(saved);
                    document.getElementById('drone-ip').value = settings.droneIP || '192.168.11.1';
                    document.getElementById('drone-port').value = settings.dronePort || '8080';
                    document.getElementById('auto-connect').checked = settings.autoConnect !== false;
                    
                    state.droneIP = settings.droneIP || '192.168.11.1';
                    state.dronePort = settings.dronePort || '8080';
                } catch (e) {
                    console.error('Ошибка загрузки настроек:', e);
                }
            }
        }
        
        // Показать уведомление
        function showNotification(message, type) {
            // Удаляем старые уведомления
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            // Создаем элемент уведомления
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // Добавляем на страницу
            document.body.appendChild(notification);
            
            // Удаляем через 4 секунды
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', initInterface);
    </script>
</body>
</html>