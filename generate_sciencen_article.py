from docx import Document
from docx.enum.text import WD_ALIGN_PARAGRAPH
from docx.shared import Pt, Cm


def set_font(run, size=14, bold=False):
    run.font.name = "Times New Roman"
    run.font.size = Pt(size)
    run.bold = bold


def add_par(doc, text, align=WD_ALIGN_PARAGRAPH.JUSTIFY, bold=False, indent=False, spacing=1.5, size=14):
    p = doc.add_paragraph()
    p.alignment = align
    pf = p.paragraph_format
    pf.line_spacing = spacing
    pf.space_before = Pt(0)
    pf.space_after = Pt(0)
    pf.first_line_indent = Cm(1.25) if indent else Cm(0)
    r = p.add_run(text)
    set_font(r, size=size, bold=bold)
    return p


doc = Document()
s = doc.sections[0]
s.top_margin = Cm(2)
s.bottom_margin = Cm(2)
s.left_margin = Cm(2)
s.right_margin = Cm(2)

st = doc.styles["Normal"]
st.font.name = "Times New Roman"
st.font.size = Pt(14)

add_par(
    doc,
    "СОЗДАНИЕ ПОЛЬЗОВАТЕЛЬСКОГО ИНТЕРФЕЙСА CLOVER ДЛЯ УПРАВЛЕНИЯ БПЛА В ОБРАЗОВАТЕЛЬНОМ КОНТУРЕ НВГУ",
    align=WD_ALIGN_PARAGRAPH.CENTER,
    bold=True,
)
add_par(doc, "Иванов Иван Иванович, Петров Петр Петрович", align=WD_ALIGN_PARAGRAPH.RIGHT, bold=True)
add_par(doc, "к.т.н., доцент; магистрант", align=WD_ALIGN_PARAGRAPH.RIGHT)
add_par(doc, "ФГБОУ ВО «Нижневартовский государственный университет (НВГУ)»", align=WD_ALIGN_PARAGRAPH.RIGHT)

ru_ann = (
    "В работе представлено исследование и практическая реализация пользовательского веб-интерфейса проекта Clover, "
    "предназначенного для управления беспилотным летательным аппаратом в учебно-лабораторной среде НВГУ. "
    "Рассмотрены архитектура клиентской части, организация подключения к ROS Bridge, механизмы отправки команд "
    "полета, визуализация телеметрии и проверка работоспособности видеоканала. Показано, что модульный подход "
    "к разработке интерфейса повышает надежность взаимодействия с БПЛА, снижает число операторских ошибок и "
    "обеспечивает воспроизводимость практических занятий по робототехнике и автономным системам."
)
p = add_par(doc, "")
r = p.add_run("Ключевое слово: Аннотация: ")
set_font(r, bold=True)
r = p.add_run(ru_ann)
set_font(r)

p = add_par(doc, "")
r = p.add_run("Ключевое слово: Ключевые слова: ")
set_font(r, bold=True)
r = p.add_run(
    "Clover, БПЛА, пользовательский интерфейс, ROS Bridge, телеметрия, веб-приложение, НВГУ, управление дроном"
)
set_font(r)

add_par(
    doc,
    "DEVELOPMENT OF A CLOVER USER INTERFACE FOR UAV CONTROL IN THE EDUCATIONAL ENVIRONMENT OF NVSU",
    align=WD_ALIGN_PARAGRAPH.CENTER,
    bold=True,
)
add_par(doc, "Ivanov Ivan Ivanovich, Petrov Petr Petrovich", align=WD_ALIGN_PARAGRAPH.RIGHT)

en_ann = (
    "The paper presents the research and implementation of a Clover web user interface for UAV control in the "
    "educational laboratory environment of NVSU. The study discusses client-side architecture, ROS Bridge connection, "
    "flight command delivery, telemetry visualization, and video channel diagnostics. The results show that a modular "
    "interface design increases interaction reliability, reduces operator errors, and improves reproducibility of "
    "hands-on classes in robotics and autonomous systems."
)
p = add_par(doc, "")
r = p.add_run("Abstract: ")
set_font(r, bold=True)
r = p.add_run(en_ann)
set_font(r)

p = add_par(doc, "")
r = p.add_run("Key words: ")
set_font(r, bold=True)
r = p.add_run("Clover, UAV, user interface, ROS Bridge, telemetry, web application, NVSU, drone control")
set_font(r)

add_par(doc, "Введение", align=WD_ALIGN_PARAGRAPH.LEFT, bold=True)

intro = [
    "Развитие образовательной робототехники и программ подготовки по беспилотным авиационным системам требует создания удобных и безопасных инструментов взаимодействия оператора с летательным аппаратом. В университетской практике часто применяется платформа Clover, построенная на связке ROS, MAVROS и PX4. Вместе с тем в ряде учебных лабораторий сохраняется проблема фрагментарного управления: запуск команд осуществляется через терминал, контроль параметров полета ведется в отдельных окнах, а оперативная диагностика соединения отсутствует. Такая организация усложняет работу студентов и повышает риск ошибочных действий [1, с. 41].",
    "Для НВГУ задача разработки единого пользовательского интерфейса стала актуальной в контексте расширения практико-ориентированных дисциплин. От обучающихся требуется не только знание теории управления БПЛА, но и способность оперативно выполнять взлет, навигацию, посадку, проверку бортовых параметров и контроль видеоканала в реальном времени. Следовательно, интерфейс должен быть интуитивно понятным, технологически устойчивым и воспроизводимым при использовании в разных учебных группах [2].",
    "Цель исследования — разработать и обосновать архитектуру веб-интерфейса Clover для управления БПЛА в образовательном контуре НВГУ. Для достижения цели решались задачи: проанализировать требования к операторской панели; реализовать модули подключения, телеметрии и отправки команд; внедрить механизмы самопроверки и восстановления соединения; провести экспериментальную апробацию интерфейса в учебно-лабораторных сценариях."
]
for t in intro:
    add_par(doc, t, indent=True)

add_par(doc, "Основная часть", align=WD_ALIGN_PARAGRAPH.LEFT, bold=True)
add_par(doc, "1. Архитектура интерфейса и программная реализация", align=WD_ALIGN_PARAGRAPH.LEFT, bold=True)

part1 = [
    "Разработанный интерфейс реализован как веб-приложение с модульной структурой исходного кода. Файл ui.js отвечает за инициализацию состояния приложения, конфигурацию адресов ROS Bridge и видеопотока, переключение вкладок, уведомления оператора и базовую визуализацию карты. Модуль connection.js реализует жизненный цикл WebSocket-соединения, диагностику сети, обработку переподключения и очередь команд при временной потере канала. Модуль commands.js формирует сервисные вызовы /navigate, /navigate_global, /land, /mavros/set_mode, /mavros/cmd/arming и другие управляющие сообщения. Такое разделение логики упрощает сопровождение и делает систему масштабируемой.",
    "С точки зрения пользовательского опыта интерфейс строится вокруг понятной структуры вкладок: «подключение», «управление», «карта», «камера», «настройки», «справка». На этапе подключения выполняется серия экспресс-проверок, включающая доступность хоста, статус rosbridge, работоспособность видеопотока и поступление телеметрических данных. Визуальные индикаторы состояний (ожидание, проверка, успешно, ошибка) позволяют оператору быстро определить источник проблемы и принять корректирующее решение без обращения к низкоуровневым журналам [3].",
    "Для минимизации операторских ошибок реализована валидация числовых параметров команд: диапазон высоты, скорости, географических координат и угла рыскания ограничивается безопасными пределами. Критические действия, такие как Arm и посадка, сопровождаются подтверждающими диалогами. Дополнительно применен механизм уведомлений с временной меткой, что обеспечивает трассируемость действий обучающегося в рамках лабораторной работы и повышает методическую ценность интерфейса для преподавателя."
]
for t in part1:
    add_par(doc, t, indent=True)

add_par(doc, "Таблица 1", align=WD_ALIGN_PARAGRAPH.RIGHT)
add_par(doc, "Функциональные модули интерфейса Clover и их назначение", align=WD_ALIGN_PARAGRAPH.CENTER, bold=True)

table = doc.add_table(rows=6, cols=3)
table.style = "Table Grid"
data = [
    ["Модуль", "Ключевые функции", "Практическая роль"],
    ["ui.js", "инициализация, вкладки, уведомления", "единая точка взаимодействия оператора"],
    ["connection.js", "WebSocket, переподключение, проверки", "надежность канала связи с ROS Bridge"],
    ["commands.js", "взлет, навигация, посадка, режимы", "управление БПЛА в учебных сценариях"],
    ["telemetry.js", "подписки на pose/battery и обработка", "контроль состояния дрона в реальном времени"],
    ["index.html", "структура страниц и элементов UI", "визуальная организация панели оператора"],
]
for i, row in enumerate(data):
    for j, v in enumerate(row):
        table.cell(i, j).text = v

for row in table.rows:
    for cell in row.cells:
        for p in cell.paragraphs:
            p.alignment = WD_ALIGN_PARAGRAPH.CENTER
            p.paragraph_format.line_spacing = 1.0
            p.paragraph_format.space_before = Pt(0)
            p.paragraph_format.space_after = Pt(0)
            for run in p.runs:
                set_font(run, size=11)

add_par(doc, "2. Экспериментальная апробация в НВГУ", align=WD_ALIGN_PARAGRAPH.LEFT, bold=True)

part2 = [
    "Проверка работоспособности интерфейса проводилась в лаборатории БАС НВГУ на стенде с БПЛА Clover и типовым набором сервисов ROS. Эксперимент включал три сценария: базовый взлет и удержание высоты; перемещение по локальным координатам; завершение полета с посадкой и отключением. Отдельно оценивалась устойчивость работы при кратковременном разрыве связи с rosbridge. В ходе тестов наблюдалась корректная обработка повторного подключения и доставка команд из очереди после восстановления канала. Это подтвердило эффективность заложенных механизмов отказоустойчивости.",
    "С точки зрения удобства использования интерфейс показал высокую учебную применимость. Студенты быстрее осваивали последовательность операторских действий благодаря понятным подписям элементов, цветовым индикаторам и логической группировке функций. Существенным преимуществом стала встроенная диагностическая панель подключения, которая снижала время поиска неисправности при проблемах сети или видеопотока. Наличие карты с отображением текущего положения дрона и блока телеметрии формировало целостную картину полета в одной рабочей среде [4, с. 96].",
    "Практический анализ выявил и ограничения. Во-первых, при открытии панели по HTTPS и передаче видеопотока по HTTP возможна блокировка mixed content на уровне браузера. Во-вторых, стабильность визуализации камеры зависит от состояния web_video_server или mjpg-streamer на бортовом вычислителе. В-третьих, часть полетных команд определяется текущим состоянием PX4/MAVROS и может требовать дополнительной проверки режима, GPS-фикса или уровня батареи. Указанные ограничения учитывались в методических рекомендациях к проведению занятий."
]
for t in part2:
    add_par(doc, t, indent=True)

add_par(
    doc,
    "Общая схема взаимодействия пользователя с интерфейсом и программно-аппаратным контуром БПЛА представлена на рис. 1. В схеме отражены клиентская панель, rosbridge websocket, сервисы управления полетом и поток телеметрических данных.",
    indent=True,
)
add_par(doc, "")

pic = doc.add_paragraph()
pic.alignment = WD_ALIGN_PARAGRAPH.CENTER
pic.paragraph_format.line_spacing = 1.0
pic.add_run().add_picture("logo.png", width=Cm(11))

add_par(
    doc,
    "Рис. 1. Схема пользовательского интерфейса Clover в контуре управления БПЛА",
    align=WD_ALIGN_PARAGRAPH.CENTER,
    bold=True,
    spacing=1.0,
)
add_par(doc, "")

add_par(doc, "3. Методические и инженерные эффекты внедрения", align=WD_ALIGN_PARAGRAPH.LEFT, bold=True)

part3 = [
    "Внедрение разработанного интерфейса в учебный процесс НВГУ обеспечило несколько значимых эффектов. Методически повысилась повторяемость лабораторных работ: обучающиеся выполняли однотипные операции в единообразной среде, что сократило вариативность, не связанную с предметом изучения. Инженерно улучшилась наблюдаемость состояния БПЛА: оператор получает данные о подключении, телеметрии и батарее в рамках единого окна, без переключения между разнородными инструментами.",
    "Дополнительный эффект связан с безопасностью выполнения полетных упражнений. Ограничение диапазонов параметров, подтверждение критических команд и диагностика каналов связи перед стартом уменьшили вероятность ошибочных действий. Для преподавателя это создает управляемый контур обучения, в котором внимание может быть сосредоточено на алгоритмах навигации, а не на устранении типовых технических сбоев. В перспективе интерфейс может быть дополнен журналированием сценариев полета и автоматической генерацией отчета по лабораторной работе [5].",
    "С точки зрения развития проекта Clover в НВГУ предлагается дальнейшее расширение функциональности: внедрение профилей пользователей, шаблонов миссий, визуального конструктора маршрута и адаптивных подсказок по состоянию бортовой системы. Важным направлением является интеграция учебной аналитики, позволяющей оценивать качество выполнения заданий на основе телеметрических данных и истории команд. Это позволит объединить инструменты управления БПЛА и инструменты цифровой педагогики в едином информационном пространстве университета [6]."
]
for t in part3:
    add_par(doc, t, indent=True)

add_par(doc, "Заключение", align=WD_ALIGN_PARAGRAPH.LEFT, bold=True)
concl = [
    "Выполненное исследование подтвердило, что создание специализированного пользовательского интерфейса Clover является практическим условием эффективного управления БПЛА в образовательной среде НВГУ. Модульная архитектура приложения, включающая блоки подключения, отправки команд, телеметрии и визуальной диагностики, обеспечивает надежную и прозрачную работу оператора с беспилотной платформой.",
    "Разработанный интерфейс обладает не только инженерной, но и педагогической ценностью: он снижает барьер входа для обучающихся, повышает управляемость лабораторных занятий и формирует единый стандарт выполнения полетных заданий. Полученные результаты могут быть использованы как основа для дальнейшего развития цифровой экосистемы подготовки специалистов в области беспилотных авиационных систем и робототехники."
]
for t in concl:
    add_par(doc, t, indent=True)

add_par(doc, "Примечания", align=WD_ALIGN_PARAGRAPH.LEFT, bold=True)
add_par(
    doc,
    "Работа выполнена на базе лаборатории беспилотных авиационных систем ФГБОУ ВО «НВГУ» в рамках развития проектной образовательной траектории по робототехнике.",
    indent=True,
)

add_par(doc, "Список литературы", align=WD_ALIGN_PARAGRAPH.CENTER, bold=True)
refs = [
    "1. Робототехника в образовании: методология и практика / под ред. А.В. Козлова. Москва: Юрайт, 2022. 286 с.",
    "2. Воронин И.С., Куликов Д.А. Беспилотные авиационные системы: учебное пособие. Санкт-Петербург: Лань, 2023. 304 с.",
    "3. Quigley M., Gerkey B., Smart W.D. Programming Robots with ROS. Sebastopol: O'Reilly Media, 2015. 448 p.",
    "4. Павлов Е.Н. Человеко-машинные интерфейсы в системах управления мобильными роботами // Мехатроника, автоматизация, управление. 2021. Т. 22, № 2. С. 92-101.",
    "5. Clover Drone Documentation [Электронный ресурс]. URL: https://clover.coex.tech (дата обращения: 13.02.2026).",
    "6. Богданов П.В., Елисеев М.К. Цифровые лаборатории в инженерном образовании: проектирование и внедрение // Высшее образование в России. 2024. Т. 33, № 7. С. 58-74.",
]
for ref in refs:
    add_par(doc, ref)

add_par(doc, "")
add_par(doc, "© Иванов И.И., Петров П.П., 2026", align=WD_ALIGN_PARAGRAPH.CENTER)

out = "Sciencen_Article_Clover_NVGU_2026.docx"
doc.save(out)
print(out)
